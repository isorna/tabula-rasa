<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/polymerfire/polymerfire.html">
<script src="../data/app-dataconfig.js"></script>

<dom-module id="app-data">

  <template>

    <style>

      :host {
        display: block;
        --app-primary-color: #4285f4;
        --app-secondary-color: black;
      }

      [hidden="true"] {
        display: none;
      }

      .user-data img {
        display: block;
        border: 1px solid #ccc;
        padding: 4px;
        background-color: #fff;
        float: left;
        margin: 0 30px 30px 0;
      }
      .user-data button {
        float: right;
      }

      button {
        background: #2196F3;
        color: white;
        border: 0;
        border-radius: 3px;
        text-transform: uppercase;
        padding: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
      }
      input {
        padding: 8px;
        font-size: 14px;
        font-family: Roboto, sans-serif;
        border: 1px solid #ddd;
        display: block;
        max-width: 300px;
        margin-bottom: 8px;
      }

      .error {
        background: #f44336;
        color: white;
        padding: 8px;
        font-size: 14px;
        border-radius: 3px;
        margin: 16px auto;
        max-width: 800px;
      }
    </style>

    <firebase-app auth-domain="{{firebaseData.authDomain}}"
      database-url="{{firebaseData.databaseUrl}}"
      api-key="{{firebaseData.apiKey}}"
      storageBucket="{{firebaseData.storageBucket}}">
    </firebase-app>

    <!--firebase-document
      path="/home/title"
      data="{{homeTitle}}">
    </firebase-document-->

    <firebase-auth id="auth" user="{{user}}" signedIn="{{signedIn}}" provider="google" on-error="_handleError"></firebase-auth>

    <div class="error" hidden$="{{!error}}">{{error.code}}: {{error.message}}</div>

    <div hidden$="{{user}}" class="user-data">
      <!--h3>Email/Password</h3>
      <form on-submit="signInWithEmailAndPassword">
        <input value="{{email::input}}" type="email" placeholder="Email">
        <input value="{{password::input}}" type="password" placeholder="Password">
        <button type="submit" on-tap="signInWithEmailAndPassword">Sign In</button>
        <button type="button" on-tap="createUserWithEmailAndPassword">Sign Up</button>
      </form-->
      <!--h3>Anonymous/OAuth</h3-->
      <p>
        <!--button on-tap="signInAnonymously">Sign In Anonymously</button-->
        <button on-tap="_signInWithGoogle">Sign In With Google</button>
      </p>
    </div>
    <div hidden$="{{!user}}" class="user-data">
      <img src="{{user.photoURL}}" alt="{{user.displayName}}">
      <p>You're identified as <strong>{{user.displayName}}</strong> &lt;{{user.email}}&gt;</p>
      <!--p>uid: {{user.uid}}</p>
      <p>email verified: {{user.emailVerified}}</p-->

      <button on-tap="_signOut">Sign Out</button>
    </div>
  </template>

  <script>

    Polymer({

      is: 'app-data',

      properties: {
        error: {
          type: Boolean,
          value: false
        },
        user: {
          type: Object,
          notify: true
        },
        firebaseData: {
          type: Object,
          notify: true,
          value: goFirebaseData
        }
      },

      _handleError: function (e) {
        console.error(e.detail);
        this.error = e.detail;
      },

      _signInAnonymously: function() {
        this.error = null;
        this.$.auth.signInAnonymously();
      },

      _signInWithGoogle: function() {
        this.error = null;
        //this.auth = this.$.auth;
        this.$.auth.signInWithPopup()
          .then(function(response) {console.log('login ok', response);})
          .catch(function(error) {console.error('login error', error);});
      },

      _signInWithEmailAndPassword: function(e) {
        if (e) { e.preventDefault(); }
        this.error = null;
        this.$.auth.signInWithEmailAndPassword(this.email, this.password);
        this.email = null;
        this.password = null;
      },

      _createUserWithEmailAndPassword: function() {
        this.error = null;
        this.$.auth.createUserWithEmailAndPassword(this.email, this.password);
        this.email = null;
        this.password = null;
      },

      _signOut: function() {
        this.error = null;
        this.$.auth.signOut();
      }

    });

  </script>

</dom-module>
